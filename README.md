# ภาพรวม ER Diagram ของ MISP (Mermaid)
เอกสารนี้สรุปแผนภาพ Entity-Relationship (ER) สำหรับโครงสร้างข้อมูลหลักของ MISP ที่มีอยู่ในไฟล์ `ER_diagram.md` โดยแยกเป็นหมวดหมู่เพื่ออธิบายว่าแต่ละกลุ่มตารางมีไว้ทำไมและเชื่อมโยงกันอย่างไร พร้อมแนวทางเปิดดูแผนภาพใน mermaid.live

## วิธีใช้แผนภาพ
1. เปิดไฟล์ [`ER_diagram.md`](./ER_diagram.md) แล้วคัดลอกโค้ด Mermaid ทั้งบล็อก
2. วางลงใน [mermaid.live](https://mermaid.live/edit) แล้วกด Render เพื่อดูแผนภาพโต้ตอบ
3. ปรับ Layout หรือส่งออกเป็น PNG/SVG จากเมนู Export ได้ทันที

## หมวดหมู่ข้อมูลหลัก
- **แกนเหตุการณ์ (Events & Attributes):** `EVENTS` เป็นหัวใจเก็บเหตุการณ์ภัยคุกคาม พร้อมคีย์ เช่น `info`, `threat_level_id`, `distribution` และเชื่อมไปยัง `ATTRIBUTE` ที่ใช้เก็บ Indicator รายการย่อย เช่น IP, Domain, Hash รวมถึงฟิลด์ด้านแหล่งที่มา (`event_id`, `category`, `type`).
- **โครงร่างวัตถุ (Objects & References):** `OBJECT` ใช้แทนกลุ่มข้อมูลที่เป็นโครงสร้าง (เช่น ไฟล์, อีเมล) และผูกกับ `EVENTS` ผ่าน `event_id` ส่วน `OBJECT_REFERENCE` ระบุความสัมพันธ์ระหว่างวัตถุ/แอตทริบิวต์ (เช่น "ไฟล์นี้ถูกส่งผ่านอีเมลฉบับนี้")
- **คำอธิบายเสริม (Context & Galaxy):** `GALAXY`, `GALAXY_CLUSTER`, และ `GALAXY_CLUSTER_VALUE` ใช้บรรยายบริบท เช่น องค์กรผู้โจมตี, TTPs และเชื่อมกับรายการข้อมูลผ่าน `GALAXY_REFERENCES` ขณะเดียวกัน `TAG` และ `TAXONOMY` ให้โครงสร้างแท็กมาตรฐาน
- **การแบ่งปันและสิทธิ์ (Sharing & ACL):** กลไกการเผยแพร่ใช้ `SERVER`, `ORGANISATIONS`, และ `ORGANISATION_LOG` ส่วนการควบคุมสิทธิ์สำหรับผู้ใช้ถูกจัดการโดย `USER`, `ROLE`, `USER_ROLE`, และความสัมพันธ์กับองค์กร (`org_id`) เพื่อกำหนดขอบเขตการเข้าถึงข้อมูล
- **การตรวจสอบและซิงก์ (Audit & Sync):** `LOG` บันทึกกิจกรรมสำคัญ เช่น การสร้าง/แก้ไข ขณะที่ `USER_SETTING` และฟิลด์อย่าง `timestamp` ในหลายตารางช่วยติดตามการเปลี่ยนแปลงและซิงก์ระหว่างโหนด

## ความสัมพันธ์สำคัญที่ควรสังเกต
- `EVENTS` เชื่อมกับ `ATTRIBUTE` และ `OBJECT` ผ่าน `event_id` เพื่อรวมทุกองค์ประกอบของเหตุการณ์
- `OBJECT_REFERENCE` เชื่อมระหว่าง `OBJECT` หรือ `ATTRIBUTE` ด้วยฟิลด์ `object_uuid` และ `referenced_uuid` ทำให้มองเห็นสายสัมพันธ์เชิงสาเหตุหรือโครงสร้าง
- การติดแท็ก (`TAG`/`TAXONOMY`) และ `GALAXY_REFERENCES` สามารถผูกกับเหตุการณ์หรือแอตทริบิวต์เพื่อเพิ่มบริบทและการค้นหา
- สิทธิ์ผู้ใช้ (`USER`, `ROLE`, `USER_ROLE`) และการสังกัดองค์กร (`ORGANISATIONS`) กำหนดว่าข้อมูลใดแชร์หรือมองเห็นได้ผ่านฟิลด์ `distribution` ในหลายตาราง

## เคล็ดลับการอ่านแผนภาพ
- มองจากบนลงล่าง: เริ่มที่ `EVENTS` แล้วตามเส้นเชื่อมไป `ATTRIBUTE` และ `OBJECT` เพื่อเข้าใจข้อมูลหลักก่อน
- ดูสีหรือกลุ่ม (ถ้าเปิดใน mermaid.live): ใช้การเน้นกลุ่มเพื่อแยกส่วน Metadata, Sharing, และ Context
- ตรวจสอบคีย์สำคัญ: ฟิลด์ `uuid`, `org_id`, `event_id`, และ `distribution` เป็นตัวหลักที่เชื่อมตารางต่าง ๆ

หากต้องการแก้ไขหรือขยาย ER Diagram สามารถปรับโค้ดใน `ER_diagram.md` แล้วเรนเดอร์ใหม่บน mermaid.live เพื่อทดสอบความเชื่อมโยงทันที
